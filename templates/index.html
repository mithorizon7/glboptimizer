<!DOCTYPE html>
<html lang="en" data-bs-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GLB Optimizer - Industry-Standard GLB File Optimization</title>
    <link href="https://cdn.replit.com/agent/bootstrap-agent-dark-theme.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="{{ url_for('static', filename='style.css') }}" rel="stylesheet">
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="row justify-content-center">
            <div class="col-lg-10">
                <header class="text-center py-5">
                    <h1 class="display-4 mb-3">
                        <i class="fas fa-cube me-3"></i>
                        GLB Optimizer
                    </h1>
                    <p class="lead">
                        Industry-standard GLB file optimization using gltf-transform and gltfpack
                    </p>
                    <p class="text-muted">
                        Reduce file sizes by 5-10× while maintaining visual fidelity
                    </p>
                </header>
            </div>
        </div>

        <!-- Upload Section -->
        <div class="row justify-content-center" id="upload-section">
            <div class="col-lg-8">
                <div class="card">
                    <div class="card-body p-5">
                        <h3 class="card-title text-center mb-4">
                            <i class="fas fa-upload me-2"></i>
                            Upload GLB File
                        </h3>
                        
                        <!-- Drop Zone -->
                        <div id="drop-zone" class="drop-zone text-center p-5 mb-4">
                            <i class="fas fa-cloud-upload-alt fa-3x mb-3 text-muted"></i>
                            <h5>Drag & drop your GLB file here</h5>
                            <p class="text-muted">or click to select a file</p>
                            <input type="file" id="file-input" accept=".glb" style="display: none;">
                            <button type="button" class="btn btn-outline-secondary" onclick="document.getElementById('file-input').click()">
                                <i class="fas fa-folder-open me-2"></i>
                                Choose File
                            </button>
                        </div>

                        <!-- File Info -->
                        <div id="file-info" class="alert alert-info" style="display: none;">
                            <i class="fas fa-info-circle me-2"></i>
                            <span id="file-details"></span>
                        </div>

                        <!-- Optimization Settings -->
                        <div id="optimization-settings" class="card mt-4" style="display: none;">
                            <div class="card-body">
                                <h6 class="card-title">Optimization Settings</h6>
                                <div class="row">
                                    <div class="col-md-6">
                                        <label for="quality-level" class="form-label">Quality Level</label>
                                        <select id="quality-level" class="form-select">
                                            <option value="high" selected>High Quality (Recommended)</option>
                                            <option value="balanced">Balanced</option>
                                            <option value="maximum_compression">Maximum Compression</option>
                                        </select>
                                        <div class="form-text">High quality preserves visual fidelity, maximum compression prioritizes file size.</div>
                                    </div>
                                    <div class="col-md-6">
                                        <label class="form-label">Advanced Features</label>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="enable-lod" checked>
                                            <label class="form-check-label" for="enable-lod">
                                                Generate LOD (Level of Detail)
                                            </label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="enable-simplification" checked>
                                            <label class="form-check-label" for="enable-simplification">
                                                Polygon Simplification
                                            </label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Upload Button -->
                        <div class="text-center mt-4">
                            <button id="upload-btn" class="btn btn-primary btn-lg" disabled>
                                <i class="fas fa-rocket me-2"></i>
                                Start Optimization
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Progress Section -->
        <div class="row justify-content-center mt-4" id="progress-section" style="display: none;">
            <div class="col-lg-8">
                <div class="card">
                    <div class="card-body p-4">
                        <h4 class="card-title mb-4">
                            <i class="fas fa-cogs me-2"></i>
                            Optimization Progress
                        </h4>
                        
                        <!-- Progress Bar -->
                        <div class="mb-3">
                            <div class="progress" style="height: 20px;">
                                <div id="progress-bar" class="progress-bar progress-bar-striped progress-bar-animated" 
                                     role="progressbar" style="width: 0%"></div>
                            </div>
                        </div>
                        
                        <!-- Progress Info -->
                        <div class="row">
                            <div class="col-md-6">
                                <p class="mb-1"><strong>Current Step:</strong></p>
                                <p id="current-step" class="text-muted">Initializing...</p>
                            </div>
                            <div class="col-md-6">
                                <p class="mb-1"><strong>Progress:</strong></p>
                                <p id="progress-text" class="text-muted">0%</p>
                            </div>
                        </div>
                        
                        <!-- File Size Info -->
                        <div class="row mt-3" id="size-info" style="display: none;">
                            <div class="col-md-4">
                                <div class="text-center">
                                    <h6>Original Size</h6>
                                    <span id="original-size" class="badge bg-secondary fs-6"></span>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="text-center">
                                    <h6>Optimized Size</h6>
                                    <span id="optimized-size" class="badge bg-success fs-6"></span>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="text-center">
                                    <h6>Compression</h6>
                                    <span id="compression-ratio" class="badge bg-primary fs-6"></span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Results Section -->
        <div class="row justify-content-center mt-4" id="results-section" style="display: none;">
            <div class="col-lg-8">
                <div class="card">
                    <div class="card-body p-4">
                        <h4 class="card-title mb-4">
                            <i class="fas fa-check-circle text-success me-2"></i>
                            Optimization Complete
                        </h4>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <h6>Optimization Statistics</h6>
                                <ul class="list-unstyled">
                                    <li><strong>Original Size:</strong> <span id="result-original-size"></span></li>
                                    <li><strong>Optimized Size:</strong> <span id="result-optimized-size"></span></li>
                                    <li><strong>Size Reduction:</strong> <span id="result-compression"></span></li>
                                    <li><strong>Processing Time:</strong> <span id="result-time"></span></li>
                                </ul>
                            </div>
                            <div class="col-md-6">
                                <h6>Optimization Steps Applied</h6>
                                <ul class="list-unstyled">
                                    <li><i class="fas fa-check text-success me-2"></i>Cleanup & Deduplication (Prune, Weld, Join)</li>
                                    <li><i class="fas fa-check text-success me-2"></i>Geometry Compression (Meshopt + Draco fallback)</li>
                                    <li><i class="fas fa-check text-success me-2"></i>Texture Compression (KTX2/BasisU + Channel Packing)</li>
                                    <li><i class="fas fa-check text-success me-2"></i>Animation Optimization (Resample + Quantize)</li>
                                    <li><i class="fas fa-check text-success me-2"></i>LOD Generation & Progressive Delivery</li>
                                    <li><i class="fas fa-check text-success me-2"></i>Final Bundle & Minify</li>
                                </ul>
                            </div>
                        </div>
                        
                        <!-- 3D Viewer Section -->
                        <div class="row mt-4" id="model-viewer-section">
                            <div class="col-12">
                                <h6 class="mb-3">
                                    <i class="fas fa-cube me-2"></i>
                                    3D Model Comparison
                                </h6>
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="card">
                                            <div class="card-header text-center">
                                                <h6 class="mb-0">Original Model</h6>
                                                <small class="text-muted" id="original-model-size"></small>
                                            </div>
                                            <div class="card-body p-0">
                                                <div id="original-viewer" class="model-viewer"></div>
                                                <div class="viewer-controls p-2">
                                                    <small class="text-muted">
                                                        <i class="fas fa-mouse me-1"></i> Click & drag to rotate
                                                        <i class="fas fa-expand-arrows-alt ms-2 me-1"></i> Scroll to zoom
                                                    </small>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="card">
                                            <div class="card-header text-center">
                                                <h6 class="mb-0">Optimized Model</h6>
                                                <small class="text-muted" id="optimized-model-size"></small>
                                            </div>
                                            <div class="card-body p-0">
                                                <div id="optimized-viewer" class="model-viewer"></div>
                                                <div class="viewer-controls p-2">
                                                    <small class="text-muted">
                                                        <i class="fas fa-mouse me-1"></i> Click & drag to rotate
                                                        <i class="fas fa-expand-arrows-alt ms-2 me-1"></i> Scroll to zoom
                                                    </small>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="text-center mt-3">
                                    <button id="sync-cameras-btn" class="btn btn-outline-primary btn-sm me-2">
                                        <i class="fas fa-link me-1"></i>
                                        Sync Camera Views
                                    </button>
                                    <button id="reset-cameras-btn" class="btn btn-outline-secondary btn-sm">
                                        <i class="fas fa-undo me-1"></i>
                                        Reset Views
                                    </button>
                                </div>
                            </div>
                        </div>

                        <div class="text-center mt-4">
                            <button id="download-btn" class="btn btn-success btn-lg me-3">
                                <i class="fas fa-download me-2"></i>
                                Download Optimized GLB
                            </button>
                            <button id="new-optimization-btn" class="btn btn-outline-secondary btn-lg">
                                <i class="fas fa-plus me-2"></i>
                                Optimize Another File
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Error Section -->
        <div class="row justify-content-center mt-4" id="error-section" style="display: none;">
            <div class="col-lg-8">
                <div class="alert alert-danger">
                    <h5 class="alert-heading">
                        <i class="fas fa-exclamation-triangle me-2"></i>
                        Optimization Failed
                    </h5>
                    <p id="error-message"></p>
                    <hr>
                    <button id="retry-btn" class="btn btn-outline-danger">
                        <i class="fas fa-redo me-2"></i>
                        Try Again
                    </button>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <footer class="text-center py-5 mt-5">
            <div class="row">
                <div class="col-lg-8 mx-auto">
                    <h6>Optimization Pipeline</h6>
                    <p class="text-muted small">
                        This tool implements the industry-standard 6-step GLB optimization workflow:
                        <br><strong>1.</strong> Cleanup & Deduplication (prune unused data, weld vertices, join meshes)
                        <br><strong>2.</strong> Geometry Compression (EXT_meshopt_compression with quantization + Draco fallback)
                        <br><strong>3.</strong> Texture Compression (KTX2/BasisU with channel packing, UASTC for normals)
                        <br><strong>4.</strong> Animation Optimization (resample to 30fps, compress with 16-bit quantization)
                        <br><strong>5.</strong> LOD Generation (3 levels of detail for progressive delivery)
                        <br><strong>6.</strong> Final Bundle (embed textures, apply final compression)
                    </p>
                    <p class="text-muted small">
                        Powered by <strong>gltf-transform v4.2.0</strong> and <strong>gltfpack v0.24.0</strong>
                        <br>Achieves 5-10× compression while maintaining visual fidelity
                    </p>
                </div>
            </div>
        </footer>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script type="importmap">
    {
        "imports": {
            "three": "https://unpkg.com/three@0.158.0/build/three.module.js",
            "three/addons/": "https://unpkg.com/three@0.158.0/examples/jsm/"
        }
    }
    </script>
    <script type="module" src="{{ url_for('static', filename='script.js') }}"></script>
</body>
</html>
